<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Read this vignette to learn how to compute summary statistics like cluster  abundance and cluster marker expression using {tidytof} 
">
<title>Feature extraction • tidytof</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Feature extraction">
<meta property="og:description" content="Read this vignette to learn how to compute summary statistics like cluster  abundance and cluster marker expression using {tidytof} 
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidytof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/tidytof.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Extending {tidytof}</h6>
    <a class="dropdown-item" href="../articles/contributing-to-tidytof.html">How to contribute code</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Cell-level operations</h6>
    <a class="dropdown-item" href="../articles/reading-and-writing-data.html">Reading and writing data</a>
    <a class="dropdown-item" href="../articles/quality-control.html">Quality control</a>
    <a class="dropdown-item" href="../articles/preprocessing.html">Preprocessing</a>
    <a class="dropdown-item" href="../articles/downsampling.html">Downsampling</a>
    <a class="dropdown-item" href="../articles/dimensionality-reduction.html">Dimensionality reduction</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Cluster-level operations</h6>
    <a class="dropdown-item" href="../articles/clustering.html">Clustering and metaclustering</a>
    <a class="dropdown-item" href="../articles/differential-discovery-analysis.html">Differential discovery analysis</a>
    <a class="dropdown-item" href="../articles/feature-extraction.html">Feature extraction</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Sample-level operations</h6>
    <a class="dropdown-item" href="../articles/modeling.html">Building predictive models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/keyes-timothy/tidytof/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Feature extraction</h1>
                        <h4 data-toc-skip class="author">Timothy
Keyes</h4>
            
            <h4 data-toc-skip class="date">2024-03-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/keyes-timothy/tidytof/blob/HEAD/vignettes/feature-extraction.Rmd" class="external-link"><code>vignettes/feature-extraction.Rmd</code></a></small>
      <div class="d-none name"><code>feature-extraction.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keyes-timothy.github.io/tidytof">tidytof</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<p>In addition to its functions for analyzing and visualizing CyTOF data
at the single-cell and cluster levels, <a href="https://keyes-timothy.github.io/tidytof">tidytof</a>’s
<code><a href="../reference/tof_extract_features.html">tof_extract_features()</a></code> verb allows users to aggregate
single-cell and cluster-level information in order to summarize whole
samples (or whole patients) from which cells were collected. These
features can be useful for visualizing the differences between patients
and samples in different experimental conditions or for building machine
learning models.</p>
<p>To understand how the <code><a href="../reference/tof_extract_features.html">tof_extract_features()</a></code> verb works,
it’s easiest to look at each of its subroutines (the members of the
<code>tof_extract_*</code> function family) independently.</p>
<div class="section level3">
<h3 id="accessing-the-data-for-this-vignette">Accessing the data for this vignette<a class="anchor" aria-label="anchor" href="#accessing-the-data-for-this-vignette"></a>
</h3>
<p>To demonstrate how to use these verbs, we’ll first download a dataset
originally collected for the development of the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4084463/" class="external-link">CITRUS</a>
algorithm. These data are available in the <a href="https://github.com/lmweber/HDCytoData" class="external-link">HDCytoData</a>
package, which is available on Bioconductor and can be downloaded with
the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"HDCytoData"</span><span class="op">)</span></span></code></pre></div>
<p>To load the CITRUS data into our current R session, we can call a
function from the <a href="https://github.com/lmweber/HDCytoData" class="external-link">HDCytoData</a>, which will provide it to us
in a format from the <code>{flowCore}</code> package (called a
“flowSet”). To convert this into a tidy tibble, we can use
<a href="https://keyes-timothy.github.io/tidytof">tidytof</a> built-in method for converting flowCore objects
into <code>tof_tbl</code>’s .</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citrus_raw</span> <span class="op">&lt;-</span> <span class="fu">HDCytoData</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HDCytoData/man/Bodenmiller_BCR_XL_SE.html" class="external-link">Bodenmiller_BCR_XL_flowSet</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">citrus_data</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">citrus_raw</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/as_tof_tbl.html">as_tof_tbl</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span></code></pre></div>
<p>Thus, we can see that <code>citrus_data</code> is a
<code>tof_tbl</code> with 172791 cells (one in each row) and 39 pieces
of information about each cell (one in each column).</p>
<p>We can also extract some metadata from the raw data and join it with
our single-cell data using some functions from the
<code>tidyverse</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citrus_metadata</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">flowCore</span><span class="fu">::</span><span class="fu">pData</span><span class="op">(</span><span class="va">citrus_raw</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        sample_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">file_name</span><span class="op">)</span>,</span>
<span>        patient <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">file_name</span>, <span class="st">"patient[:digit:]"</span><span class="op">)</span>,</span>
<span>        stimulation <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">file_name</span>, <span class="st">"(BCR-XL)|Reference"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        stimulation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">stimulation</span> <span class="op">==</span> <span class="st">"Reference"</span>, <span class="st">"Basal"</span>, <span class="va">stimulation</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">citrus_metadata</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   file_name                          sample_id patient  stimulation</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PBMC8_30min_patient1_BCR-XL.fcs            1 patient1 BCR-XL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PBMC8_30min_patient1_Reference.fcs         2 patient1 Basal      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PBMC8_30min_patient2_BCR-XL.fcs            3 patient2 BCR-XL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PBMC8_30min_patient2_Reference.fcs         4 patient2 Basal      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> PBMC8_30min_patient3_BCR-XL.fcs            5 patient3 BCR-XL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> PBMC8_30min_patient3_Reference.fcs         6 patient3 Basal</span></span></code></pre></div>
<p>Thus, we now have sample-level information about which patient each
sample was collected from and which stimulation condition (“Basal” or
“BCR-XL”) each sample was exposed to before data acquisition.</p>
<p>Finally, we can join this metadata with our single-cell
<code>tof_tbl</code> to obtain the cleaned dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citrus_data</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">citrus_metadata</span>, by <span class="op">=</span> <span class="st">"sample_id"</span><span class="op">)</span></span></code></pre></div>
<p>After these data cleaning steps, we now have
<code>citrus_data</code>, a <code>tof_tbl</code> containing cells
collected from 8 patients. Specifically, 2 samples were taken from each
patient: one in which the cells’ B-cell receptors were stimulated
(BCR-XL) and one in which they were not (Basal). In
<code>citrus_data</code>, each cell’s patient of origin is stored in the
<code>patient</code> column, and each cell’s stimulation condition is
stored in the <code>stimulation</code> column. In addition, the
<code>population_id</code> column stores information about cluster
labels that were applied to each cell using a combination of FlowSOM
clustering and manual merging (for details, run
<code><a href="https://rdrr.io/pkg/HDCytoData/man/Bodenmiller_BCR_XL_SE.html" class="external-link">?HDCytoData::Bodenmiller_BCR_XL</a></code> in the R console).</p>
</div>
<div class="section level3">
<h3 id="calculating-cluster-proportions-using-tof_extract_proportion">Calculating cluster proportions using
<code>tof_extract_proportion()</code><a class="anchor" aria-label="anchor" href="#calculating-cluster-proportions-using-tof_extract_proportion"></a>
</h3>
<p>First, we have <code><a href="../reference/tof_extract_proportion.html">tof_extract_proportion()</a></code>, which extracts
the proportion of cells in each cluster within each sample (with samples
defined using the <code>group_cols</code> argument):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># preprocess the numeric columns in the citrus dataset</span></span>
<span><span class="va">citrus_data</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="st">"cluster"</span>, <span class="va">population_id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_preprocess.html">tof_preprocess</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_proportion.html">tof_extract_proportion</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">patient</span>, <span class="va">stimulation</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">#&gt;   patient  stimulation `prop@cluster1` `prop@cluster2` `prop@cluster3`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1 Basal                0.019<span style="text-decoration: underline;">0</span>          0.048<span style="text-decoration: underline;">2</span>           0.447</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient1 BCR-XL               0.010<span style="text-decoration: underline;">9</span>          0.039<span style="text-decoration: underline;">5</span>           0.268</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient2 Basal                0.013<span style="text-decoration: underline;">0</span>          0.028<span style="text-decoration: underline;">0</span>           0.491</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient2 BCR-XL               0.010<span style="text-decoration: underline;">1</span>          0.014<span style="text-decoration: underline;">3</span>           0.358</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient3 Basal                0.032<span style="text-decoration: underline;">6</span>          0.083<span style="text-decoration: underline;">0</span>           0.397</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient3 BCR-XL               0.020<span style="text-decoration: underline;">0</span>          0.041<span style="text-decoration: underline;">2</span>           0.323</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: `prop@cluster4` &lt;dbl&gt;, `prop@cluster5` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `prop@cluster6` &lt;dbl&gt;, `prop@cluster7` &lt;dbl&gt;, `prop@cluster8` &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Like all members of the <code>tof_extract_*</code> function family,
<code><a href="../reference/tof_extract_proportion.html">tof_extract_proportion()</a></code> returns one row for each sample
(defined as a unique combination of values of the columns specified in
<code>group_cols</code>) and one column for each extracted feature
(above, one column for the proportion of each of the 8 clusters in
<code>citrus_data</code>). These values can also be returned in “long”
format by changing the <code>format</code> argument:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_proportion.html">tof_extract_proportion</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">patient</span>, <span class="va">stimulation</span><span class="op">)</span>,</span>
<span>        format <span class="op">=</span> <span class="st">"long"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   patient  stimulation cluster     prop</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1 Basal       cluster1 0.019<span style="text-decoration: underline;">0</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient1 Basal       cluster2 0.048<span style="text-decoration: underline;">2</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient1 Basal       cluster3 0.447  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient1 Basal       cluster4 0.237  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient1 Basal       cluster5 0.002<span style="text-decoration: underline;">19</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient1 Basal       cluster6 0.075<span style="text-decoration: underline;">9</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-cluster-marker-expression-measures-using-tof_extract_central_tendency">Calculating cluster marker expression measures using
<code>tof_extract_central_tendency()</code><a class="anchor" aria-label="anchor" href="#calculating-cluster-marker-expression-measures-using-tof_extract_central_tendency"></a>
</h3>
<p>Another member of the <code>tof_extract_*()</code> function family,
<code><a href="../reference/tof_extract_central_tendency.html">tof_extract_central_tendency()</a></code>, computes the central
tendency (e.g. mean or median) of user-specified markers in each
cluster.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_central_tendency.html">tof_extract_central_tendency</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">patient</span>, <span class="va">stimulation</span><span class="op">)</span>,</span>
<span>        marker_cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD45_In115"</span>, <span class="st">"CD4_Nd145"</span>, <span class="st">"CD20_Sm147"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        central_tendency_function <span class="op">=</span> <span class="va">mean</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 26</span></span></span>
<span><span class="co">#&gt;   patient  stimulation `CD45_In115@cluster1_ct` `CD4_Nd145@cluster1_ct`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1 BCR-XL                          4.80                  0.096<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient1 Basal                           4.68                  0.765 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient2 BCR-XL                          5.00                 -<span style="color: #BB0000;">0.057</span><span style="color: #BB0000; text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient2 Basal                           4.88                  0.808 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient3 BCR-XL                          5.04                 -<span style="color: #BB0000;">0.043</span><span style="color: #BB0000; text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient3 Basal                           4.98                  0.745 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more variables: `CD20_Sm147@cluster1_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster2_ct` &lt;dbl&gt;, `CD4_Nd145@cluster2_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD20_Sm147@cluster2_ct` &lt;dbl&gt;, `CD45_In115@cluster3_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD4_Nd145@cluster3_ct` &lt;dbl&gt;, `CD20_Sm147@cluster3_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster4_ct` &lt;dbl&gt;, `CD4_Nd145@cluster4_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD20_Sm147@cluster4_ct` &lt;dbl&gt;, `CD45_In115@cluster5_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD4_Nd145@cluster5_ct` &lt;dbl&gt;, `CD20_Sm147@cluster5_ct` &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p>The argument <code>central_tendency_function</code> can be used to
compute any summary statistic. For example, the following choice for
<code>central_tendency_function</code> will compute the 75th percentile
for each marker-cluster pair in <code>citrus_data</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_central_tendency.html">tof_extract_central_tendency</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">patient</span>, <span class="va">stimulation</span><span class="op">)</span>,</span>
<span>        marker_cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD45_In115"</span>, <span class="st">"CD4_Nd145"</span>, <span class="st">"CD20_Sm147"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        central_tendency_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 26</span></span></span>
<span><span class="co">#&gt;   patient  stimulation `CD45_In115@cluster1_ct` `CD4_Nd145@cluster1_ct`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1 BCR-XL                          5.30                 -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient1 Basal                           5.18                  1.32  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient2 BCR-XL                          5.41                 -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient2 Basal                           5.28                  1.39  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient3 BCR-XL                          5.42                 -<span style="color: #BB0000;">0.036</span><span style="color: #BB0000; text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient3 Basal                           5.41                  1.27  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more variables: `CD20_Sm147@cluster1_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster2_ct` &lt;dbl&gt;, `CD4_Nd145@cluster2_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD20_Sm147@cluster2_ct` &lt;dbl&gt;, `CD45_In115@cluster3_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD4_Nd145@cluster3_ct` &lt;dbl&gt;, `CD20_Sm147@cluster3_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster4_ct` &lt;dbl&gt;, `CD4_Nd145@cluster4_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD20_Sm147@cluster4_ct` &lt;dbl&gt;, `CD45_In115@cluster5_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD4_Nd145@cluster5_ct` &lt;dbl&gt;, `CD20_Sm147@cluster5_ct` &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-the-proportion-of-cells-with-marker-expression-above-a-threshold-using-tof_extract_proportion">Calculating the proportion of cells with marker expression above a
threshold using <code>tof_extract_proportion()</code><a class="anchor" aria-label="anchor" href="#calculating-the-proportion-of-cells-with-marker-expression-above-a-threshold-using-tof_extract_proportion"></a>
</h3>
<p><code><a href="../reference/tof_extract_threshold.html">tof_extract_threshold()</a></code> is similar to
<code><a href="../reference/tof_extract_central_tendency.html">tof_extract_central_tendency()</a></code>, but calculates the
proportion of cells above a user-specified expression value for each
marker instead of a measure of central tendency:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_threshold.html">tof_extract_threshold</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">patient</span>, <span class="va">stimulation</span><span class="op">)</span>,</span>
<span>        marker_cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD45_In115"</span>, <span class="st">"CD4_Nd145"</span>, <span class="st">"CD20_Sm147"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        threshold <span class="op">=</span> <span class="fl">5</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 26</span></span></span>
<span><span class="co">#&gt;   patient  stimulation `CD45_In115@cluster1_threshold` CD4_Nd145@cluster1_thre…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1 BCR-XL                                0.516                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient1 Basal                                 0.365                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient2 BCR-XL                                0.554                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient2 Basal                                 0.452                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient3 BCR-XL                                0.547                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient3 Basal                                 0.549                         0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​`CD4_Nd145@cluster1_threshold`</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 22 more variables: `CD20_Sm147@cluster1_threshold` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster2_threshold` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD4_Nd145@cluster2_threshold` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD20_Sm147@cluster2_threshold` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster3_threshold` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD4_Nd145@cluster3_threshold` &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculating-differences-in-marker-distributions-using-tof_extract_emd-and-tof_extract_jsd">Calculating differences in marker distributions using
<code>tof_extract_emd()</code> and <code>tof_extract_jsd()</code><a class="anchor" aria-label="anchor" href="#calculating-differences-in-marker-distributions-using-tof_extract_emd-and-tof_extract_jsd"></a>
</h3>
<p>The two final members of the <code>tof_extract_*</code> function
family – <code>tof_extract_emd</code> and <code>tof_extract_jsd</code> –
are designed specifically for comparing distributions of marker
expression between stimulation conditions. As such, they must be given a
stimulation column (using the <code>emd_col</code> or
<code>jsd_col</code> argument) that identifies the stimulation condition
each cell is in, and a <code>reference_level</code> that specifies the
reference (i.e. unstimulated) condition within the <code>emd_col</code>
or <code>jsd_col</code>.</p>
<p>With these additional arguments, <code>tof_extract_emd</code>
computes the Earth-mover’s distance between each marker’s distribution
in the stimulation conditions (within each cluster) and the basal
condition; similarly, <code>tof_extract_jsd</code> computes the
Jensen-Shannon divergence index between the same distributions. Both of
these values are ways to compare how different 2 distributions are to
one another and are more computationally expensive (but also
higher-resolution) than simply comparing measures of central
tendency.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Earth-mover's distance</span></span>
<span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_emd.html">tof_extract_emd</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="va">patient</span>,</span>
<span>        marker_cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD45_In115"</span>, <span class="st">"CD4_Nd145"</span>, <span class="st">"CD20_Sm147"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        emd_col <span class="op">=</span> <span class="va">stimulation</span>,</span>
<span>        reference_level <span class="op">=</span> <span class="st">"Basal"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 25</span></span></span>
<span><span class="co">#&gt;   patient  BCR-XL_CD45_In115@clu…¹ BCR-XL_CD4_Nd145@clu…² BCR-XL_CD20_Sm147@cl…³</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1                   0.864                   2.47                  13.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient2                   1.11                    7.05                  10.8 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient3                   0.670                   6.23                  10.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient4                   2.64                    5.86                   9.90</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient5                   0.594                   7.56                   8.13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient6                   0.661                   4.77                   7.97</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated names: ¹​`BCR-XL_CD45_In115@cluster3_emd`,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​`BCR-XL_CD4_Nd145@cluster3_emd`, ³​`BCR-XL_CD20_Sm147@cluster3_emd`</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more variables: `BCR-XL_CD45_In115@cluster7_emd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD4_Nd145@cluster7_emd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD20_Sm147@cluster7_emd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD45_In115@cluster4_emd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD4_Nd145@cluster4_emd` &lt;dbl&gt;, …</span></span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Jensen-Shannon Divergence</span></span>
<span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_jsd.html">tof_extract_jsd</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="va">patient</span>,</span>
<span>        marker_cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD45_In115"</span>, <span class="st">"CD4_Nd145"</span>, <span class="st">"CD20_Sm147"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        jsd_col <span class="op">=</span> <span class="va">stimulation</span>,</span>
<span>        reference_level <span class="op">=</span> <span class="st">"Basal"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 25</span></span></span>
<span><span class="co">#&gt;   patient  BCR-XL_CD45_In115@clu…¹ BCR-XL_CD4_Nd145@clu…² BCR-XL_CD20_Sm147@cl…³</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1                 0.036<span style="text-decoration: underline;">7</span>                  0.051<span style="text-decoration: underline;">3</span>                  0.347</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient2                 0.008<span style="text-decoration: underline;">31</span>                 0.168                   0.401</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient3                 0.010<span style="text-decoration: underline;">4</span>                  0.115                   0.357</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient4                 0.030<span style="text-decoration: underline;">1</span>                  0.135                   0.205</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient5                 0.009<span style="text-decoration: underline;">11</span>                 0.078<span style="text-decoration: underline;">9</span>                  0.274</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient6                 0.009<span style="text-decoration: underline;">72</span>                 0.034<span style="text-decoration: underline;">6</span>                  0.214</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated names: ¹​`BCR-XL_CD45_In115@cluster3_jsd`,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​`BCR-XL_CD4_Nd145@cluster3_jsd`, ³​`BCR-XL_CD20_Sm147@cluster3_jsd`</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 21 more variables: `BCR-XL_CD45_In115@cluster7_jsd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD4_Nd145@cluster7_jsd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD20_Sm147@cluster7_jsd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD45_In115@cluster4_jsd` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `BCR-XL_CD4_Nd145@cluster4_jsd` &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="putting-it-all-together-with-tof_extract_features">Putting it all together with
<code>tof_extract_features()</code><a class="anchor" aria-label="anchor" href="#putting-it-all-together-with-tof_extract_features"></a>
</h3>
<p>Finally, the <code><a href="../reference/tof_extract_features.html">tof_extract_features()</a></code> verb provides a
wrapper to each of the members of its function family, allowing users to
extract multiple features types at once. For example, the following code
extracts the proportion of each cluster, median of several markers in
each cluster, and EMD between the basal condition and stimulated
condition in each cluster for all patients in
<code>citrus_data</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">signaling_markers</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"pNFkB_Nd142"</span>, <span class="st">"pStat5_Nd150"</span>, <span class="st">"pAkt_Sm152"</span>, <span class="st">"pStat1_Eu153"</span>, <span class="st">"pStat3_Gd158"</span>,</span>
<span>        <span class="st">"pSlp76_Dy164"</span>, <span class="st">"pBtk_Er166"</span>, <span class="st">"pErk_Er168"</span>, <span class="st">"pS6_Yb172"</span>, <span class="st">"pZap70_Gd156"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">citrus_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/tof_extract_features.html">tof_extract_features</a></span><span class="op">(</span></span>
<span>        cluster_col <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>        group_cols <span class="op">=</span> <span class="va">patient</span>,</span>
<span>        stimulation_col <span class="op">=</span> <span class="va">stimulation</span>,</span>
<span>        lineage_cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD45_In115"</span>, <span class="st">"CD20_Sm147"</span>, <span class="st">"CD33_Nd148"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        signaling_cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">signaling_markers</span><span class="op">)</span>,</span>
<span>        signaling_method <span class="op">=</span> <span class="st">"emd"</span>,</span>
<span>        basal_level <span class="op">=</span> <span class="st">"Basal"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 193</span></span></span>
<span><span class="co">#&gt;   patient  `prop@cluster1` `prop@cluster2` `prop@cluster3` `prop@cluster4`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> patient1          0.014<span style="text-decoration: underline;">9</span>          0.043<span style="text-decoration: underline;">8</span>           0.356           0.351</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> patient2          0.011<span style="text-decoration: underline;">5</span>          0.021<span style="text-decoration: underline;">2</span>           0.425           0.323</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> patient3          0.025<span style="text-decoration: underline;">5</span>          0.059<span style="text-decoration: underline;">4</span>           0.355           0.217</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> patient4          0.012<span style="text-decoration: underline;">7</span>          0.041<span style="text-decoration: underline;">8</span>           0.320           0.223</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> patient5          0.020<span style="text-decoration: underline;">7</span>          0.042<span style="text-decoration: underline;">3</span>           0.377           0.269</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> patient6          0.018<span style="text-decoration: underline;">3</span>          0.049<span style="text-decoration: underline;">3</span>           0.459           0.250</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 188 more variables: `prop@cluster5` &lt;dbl&gt;, `prop@cluster6` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `prop@cluster7` &lt;dbl&gt;, `prop@cluster8` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster1_ct` &lt;dbl&gt;, `CD20_Sm147@cluster1_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD33_Nd148@cluster1_ct` &lt;dbl&gt;, `CD45_In115@cluster2_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD20_Sm147@cluster2_ct` &lt;dbl&gt;, `CD33_Nd148@cluster2_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD45_In115@cluster3_ct` &lt;dbl&gt;, `CD20_Sm147@cluster3_ct` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `CD33_Nd148@cluster3_ct` &lt;dbl&gt;, `CD45_In115@cluster4_ct` &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.3.3 (2024-02-29)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] HDCytoData_1.22.1           flowCore_2.14.2            </span></span>
<span><span class="co">#&gt;  [3] SummarizedExperiment_1.32.0 Biobase_2.62.0             </span></span>
<span><span class="co">#&gt;  [5] GenomicRanges_1.54.1        GenomeInfoDb_1.38.8        </span></span>
<span><span class="co">#&gt;  [7] IRanges_2.36.0              S4Vectors_0.40.2           </span></span>
<span><span class="co">#&gt;  [9] MatrixGenerics_1.14.0       matrixStats_1.2.0          </span></span>
<span><span class="co">#&gt; [11] ExperimentHub_2.10.0        AnnotationHub_3.10.0       </span></span>
<span><span class="co">#&gt; [13] BiocFileCache_2.10.1        dbplyr_2.5.0               </span></span>
<span><span class="co">#&gt; [15] BiocGenerics_0.48.1         stringr_1.5.1              </span></span>
<span><span class="co">#&gt; [17] dplyr_1.1.4                 tidytof_0.99.5             </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] jsonlite_1.8.8                shape_1.4.6.1                </span></span>
<span><span class="co">#&gt;   [3] magrittr_2.0.3                farver_2.1.1                 </span></span>
<span><span class="co">#&gt;   [5] rmarkdown_2.26                fs_1.6.3                     </span></span>
<span><span class="co">#&gt;   [7] zlibbioc_1.48.2               ragg_1.3.0                   </span></span>
<span><span class="co">#&gt;   [9] vctrs_0.6.5                   memoise_2.0.1                </span></span>
<span><span class="co">#&gt;  [11] RCurl_1.98-1.14               htmltools_0.5.7              </span></span>
<span><span class="co">#&gt;  [13] S4Arrays_1.2.1                curl_5.2.1                   </span></span>
<span><span class="co">#&gt;  [15] SparseArray_1.2.4             sass_0.4.9                   </span></span>
<span><span class="co">#&gt;  [17] parallelly_1.37.1             bslib_0.6.2                  </span></span>
<span><span class="co">#&gt;  [19] desc_1.4.3                    lubridate_1.9.3              </span></span>
<span><span class="co">#&gt;  [21] cachem_1.0.8                  igraph_2.0.3                 </span></span>
<span><span class="co">#&gt;  [23] mime_0.12                     lifecycle_1.0.4              </span></span>
<span><span class="co">#&gt;  [25] iterators_1.0.14              pkgconfig_2.0.3              </span></span>
<span><span class="co">#&gt;  [27] Matrix_1.6-5                  R6_2.5.1                     </span></span>
<span><span class="co">#&gt;  [29] fastmap_1.1.1                 shiny_1.8.0                  </span></span>
<span><span class="co">#&gt;  [31] GenomeInfoDbData_1.2.11       future_1.33.1                </span></span>
<span><span class="co">#&gt;  [33] digest_0.6.35                 colorspace_2.1-0             </span></span>
<span><span class="co">#&gt;  [35] AnnotationDbi_1.64.1          textshaping_0.3.7            </span></span>
<span><span class="co">#&gt;  [37] RSQLite_2.3.5                 philentropy_0.8.0            </span></span>
<span><span class="co">#&gt;  [39] filelock_1.0.3                cytolib_2.14.1               </span></span>
<span><span class="co">#&gt;  [41] fansi_1.0.6                   yardstick_1.3.1              </span></span>
<span><span class="co">#&gt;  [43] timechange_0.3.0              httr_1.4.7                   </span></span>
<span><span class="co">#&gt;  [45] polyclip_1.10-6               abind_1.4-5                  </span></span>
<span><span class="co">#&gt;  [47] compiler_4.3.3                bit64_4.0.5                  </span></span>
<span><span class="co">#&gt;  [49] withr_3.0.0                   doParallel_1.0.17            </span></span>
<span><span class="co">#&gt;  [51] viridis_0.6.5                 DBI_1.2.2                    </span></span>
<span><span class="co">#&gt;  [53] ggforce_0.4.2                 MASS_7.3-60.0.1              </span></span>
<span><span class="co">#&gt;  [55] lava_1.8.0                    rappdirs_0.3.3               </span></span>
<span><span class="co">#&gt;  [57] DelayedArray_0.28.0           tools_4.3.3                  </span></span>
<span><span class="co">#&gt;  [59] interactiveDisplayBase_1.40.0 httpuv_1.6.14                </span></span>
<span><span class="co">#&gt;  [61] future.apply_1.11.1           nnet_7.3-19                  </span></span>
<span><span class="co">#&gt;  [63] glue_1.7.0                    promises_1.2.1               </span></span>
<span><span class="co">#&gt;  [65] grid_4.3.3                    generics_0.1.3               </span></span>
<span><span class="co">#&gt;  [67] recipes_1.0.10                gtable_0.3.4                 </span></span>
<span><span class="co">#&gt;  [69] tzdb_0.4.0                    class_7.3-22                 </span></span>
<span><span class="co">#&gt;  [71] tidyr_1.3.1                   data.table_1.15.2            </span></span>
<span><span class="co">#&gt;  [73] hms_1.1.3                     tidygraph_1.3.1              </span></span>
<span><span class="co">#&gt;  [75] utf8_1.2.4                    XVector_0.42.0               </span></span>
<span><span class="co">#&gt;  [77] ggrepel_0.9.5                 BiocVersion_3.18.1           </span></span>
<span><span class="co">#&gt;  [79] foreach_1.5.2                 pillar_1.9.0                 </span></span>
<span><span class="co">#&gt;  [81] RcppHNSW_0.6.0                later_1.3.2                  </span></span>
<span><span class="co">#&gt;  [83] splines_4.3.3                 tweenr_2.0.3                 </span></span>
<span><span class="co">#&gt;  [85] lattice_0.22-5                survival_3.5-8               </span></span>
<span><span class="co">#&gt;  [87] bit_4.0.5                     emdist_0.3-3                 </span></span>
<span><span class="co">#&gt;  [89] RProtoBufLib_2.14.1           tidyselect_1.2.1             </span></span>
<span><span class="co">#&gt;  [91] Biostrings_2.70.3             knitr_1.45                   </span></span>
<span><span class="co">#&gt;  [93] gridExtra_2.3                 xfun_0.42                    </span></span>
<span><span class="co">#&gt;  [95] graphlayouts_1.1.1            hardhat_1.3.1                </span></span>
<span><span class="co">#&gt;  [97] timeDate_4032.109             stringi_1.8.3                </span></span>
<span><span class="co">#&gt;  [99] yaml_2.3.8                    evaluate_0.23                </span></span>
<span><span class="co">#&gt; [101] codetools_0.2-19              ggraph_2.2.1                 </span></span>
<span><span class="co">#&gt; [103] tibble_3.2.1                  BiocManager_1.30.22          </span></span>
<span><span class="co">#&gt; [105] cli_3.6.2                     rpart_4.1.23                 </span></span>
<span><span class="co">#&gt; [107] xtable_1.8-4                  systemfonts_1.0.6            </span></span>
<span><span class="co">#&gt; [109] munsell_0.5.0                 jquerylib_0.1.4              </span></span>
<span><span class="co">#&gt; [111] Rcpp_1.0.12                   globals_0.16.3               </span></span>
<span><span class="co">#&gt; [113] png_0.1-8                     parallel_4.3.3               </span></span>
<span><span class="co">#&gt; [115] ellipsis_0.3.2                pkgdown_2.0.7                </span></span>
<span><span class="co">#&gt; [117] gower_1.0.1                   ggplot2_3.5.0                </span></span>
<span><span class="co">#&gt; [119] readr_2.1.5                   blob_1.2.4                   </span></span>
<span><span class="co">#&gt; [121] bitops_1.0-7                  listenv_0.9.1                </span></span>
<span><span class="co">#&gt; [123] glmnet_4.1-8                  viridisLite_0.4.2            </span></span>
<span><span class="co">#&gt; [125] ipred_0.9-14                  scales_1.3.0                 </span></span>
<span><span class="co">#&gt; [127] prodlim_2023.08.28            purrr_1.0.2                  </span></span>
<span><span class="co">#&gt; [129] crayon_1.5.2                  rlang_1.1.3                  </span></span>
<span><span class="co">#&gt; [131] KEGGREST_1.42.0</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Timothy Keyes.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
