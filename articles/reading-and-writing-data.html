<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Read this vignette to learn how to read data from FCS and CSV files on disk and how to write data to FCS and CSV files on disk. 
">
<title>Reading and writing data • tidytof</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reading and writing data">
<meta property="og:description" content="Read this vignette to learn how to read data from FCS and CSV files on disk and how to write data to FCS and CSV files on disk. 
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidytof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/tidytof.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Extending {tidytof}</h6>
    <a class="dropdown-item" href="../articles/contributing-to-tidytof.html">How to contribute code</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Cell-level operations</h6>
    <a class="dropdown-item" href="../articles/reading-and-writing-data.html">Reading and writing data</a>
    <a class="dropdown-item" href="../articles/quality-control.html">Quality control</a>
    <a class="dropdown-item" href="../articles/preprocessing.html">Preprocessing</a>
    <a class="dropdown-item" href="../articles/downsampling.html">Downsampling</a>
    <a class="dropdown-item" href="../articles/dimensionality-reduction.html">Dimensionality reduction</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Cluster-level operations</h6>
    <a class="dropdown-item" href="../articles/clustering.html">Clustering and metaclustering</a>
    <a class="dropdown-item" href="../articles/differential-discovery-analysis.html">Differential discovery analysis</a>
    <a class="dropdown-item" href="../articles/feature-extraction.html">Feature extraction</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Sample-level operations</h6>
    <a class="dropdown-item" href="../articles/modeling.html">Building predictive models</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Reading and writing data</h1>
                        <h4 data-toc-skip class="author">Timothy
Keyes</h4>
            
            <h4 data-toc-skip class="date">2023-05-03</h4>
      
      
      <div class="d-none name"><code>reading-and-writing-data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keyes-timothy.github.io/tidytof">tidytof</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette teaches you how to read CyTOF data into an R session
from two common file formats in which CyTOF data is typically stored:
Flow Cytometry Standard (FCS) and Comma-Separated Value (CSV) files.</p>
<div class="section level2">
<h2 id="accessing-the-data-for-this-vignette">Accessing the data for this vignette<a class="anchor" aria-label="anchor" href="#accessing-the-data-for-this-vignette"></a>
</h2>
<p><a href="https://keyes-timothy.github.io/tidytof">tidytof</a> comes bundled with several example mass
cytometry datasets. To access the raw FCS and CSV files containing these
data, use the <code>tidytof_example_data</code> function. When called
with no arguments, <code>tidytof_example_data</code> will return a
character vector naming the datasets contained in
<a href="https://keyes-timothy.github.io/tidytof">tidytof</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tidytof_example_data.html">tidytof_example_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "aml"               "ddpr"              "ddpr_metadata.csv"</span></span>
<span><span class="co">#&gt; [4] "mix"               "mix2"              "phenograph"       </span></span>
<span><span class="co">#&gt; [7] "phenograph_csv"    "surgery"</span></span></code></pre></div>
<p>The details of the datasets contained in each of these directories
isn’t particularly important, but some basic information is as
follows:</p>
<ul>
<li>
<strong>aml</strong> - one FCS file containing myeloid cells from a
healthy bone marrow and one FCS file containing myeloid cells from an
AML patient bone marrow</li>
<li>
<strong>ddpr</strong> - two FCS files containing B-cell lineage
cells from <a href="https://pubmed.ncbi.nlm.nih.gov/29505032/" class="external-link">this
paper</a>
</li>
<li>
<strong>mix</strong> - two FCS files with different CyTOF antigen
panels (one FCS file from the “aml” directory and one from the
“phenograph” directory)</li>
<li>
<strong>mix2</strong> - three files with different CyTOF antigen
panels and different file extensions (one FCS file from the “aml”
directory and two CSV files from the “phenograph_csv directory)</li>
<li>
<strong>phenograph</strong> - three FCS files containing AML cells
from <a href="https://pubmed.ncbi.nlm.nih.gov/26095251/" class="external-link">this
paper</a>
</li>
<li>
<strong>phenograph_csv</strong> - the same cells as in the
“phenograph” directory, but stored in CSV files</li>
<li>
<strong>scaffold -</strong> three FCS files from <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4537647/" class="external-link">this
paper</a>
</li>
<li>
<strong>statistical_scaffold</strong> - three FCS files from <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5312823/" class="external-link">this
paper</a>
</li>
<li>
<strong>surgery</strong> - three FCS files from <a href="https://pubmed.ncbi.nlm.nih.gov/25253674/" class="external-link">this paper</a>
</li>
</ul>
<p>To obtain the file path for the directory containing each dataset,
call <code>tidytof_example_data</code> with one of these dataset names
as its argument. For example, to obtain the directory for the phenograph
data, we would use the following command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tidytof_example_data.html">tidytof_example_data</a></span><span class="op">(</span><span class="st">"phenograph"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/tidytof/extdata/phenograph"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-data-with-tof_read_data">Reading Data with <code>tof_read_data</code><a class="anchor" aria-label="anchor" href="#reading-data-with-tof_read_data"></a>
</h2>
<p>Using one of these directories (or any other directory containing
CyTOF data on your local machine), we can use <code>tof_read_data</code>
to read CyTOF data from raw files. Acceptable formats include FCS files
and CSV files. Importantly, <code>tof_read_data</code> is smart enough
to read single FCS/CSV files or multiple FCS/CSV files depending on
whether its first argument (<code>path</code>) leads to a single file or
to a directory of files.</p>
<p>Here, we can use <code>tof_read_data</code> to read in all of the FCS
files in the “phenograph” example dataset bundled into
<a href="https://keyes-timothy.github.io/tidytof">tidytof</a> and store it in the <code>phenograph</code>
variable.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenograph</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/tidytof_example_data.html">tidytof_example_data</a></span><span class="op">(</span><span class="st">"phenograph"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_read_data.html">tof_read_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phenograph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "tof_tbl"    "tbl_df"     "tbl"        "data.frame"</span></span></code></pre></div>
<p>Regardless of the input data file type, <a href="https://keyes-timothy.github.io/tidytof">tidytof</a> reads
data into an extended <code>tibble</code> class called a
<code>tof_tbl</code> (pronounced “tof tibble”).</p>
<p>tof tibbles are an S3 class identical to <code>tbl_df</code>, but
with one additional attribute (“panel”). <a href="https://keyes-timothy.github.io/tidytof">tidytof</a> stores
this additional attribute in <code>tof_tbl</code>s because, in addition
to analyzing CyTOF data from individual experiments, CyTOF users often
want to compare panels between experiments to find common markers or to
compare which metals are associated with particular markers across
panels. To retrieve this panel information from a <code>tof_tbl</code>,
use <code>tof_get_panel</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenograph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_get_panel.html">tof_get_panel</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 44 × 2</span></span></span>
<span><span class="co">#&gt;   metals      antigens   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Time        Time       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Cell_length Cell_length</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Ir191       DNA1       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ir193       DNA2       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more rows</span></span></span></code></pre></div>
<p>A few additional notes about <code>tof_tbl</code>s:</p>
<ul>
<li>
<code>tof_tbl</code>s contains one cell per row and one CyTOF
channel per column (to provide the data in its “tidy” format).</li>
<li>
<code>tof_read_data</code> adds an additional column to the output
<code>tof_tbl</code> encoding the name of the file from which each cell
was read (the “file_name” column).</li>
<li>Because <code>tof_tbl</code>s inherit from the <code>tbl_df</code>
class, all methods available to tibbles are also available to
<code>tof_tbl</code>s.</li>
</ul>
</div>
<div class="section level2">
<h2 id="using-tibble-methods-with-tidytof-tibbles">Using tibble methods with <code>{tidytof}</code> tibbles<a class="anchor" aria-label="anchor" href="#using-tibble-methods-with-tidytof-tibbles"></a>
</h2>
<p>As an extension of the <code>tbl_df</code> class,
<code>tof_tbl</code>s get access to all <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> and
<a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a> for free. These can be useful for performing a
variety of common operations.</p>
<p>For example, the <code>phenograph</code> object above has two columns
- <code>PhenoGraph</code> and <code>Condition</code> - that encode
categorical variables as numeric codes. We might be interested in
converting the types of these columns into strings to make sure that we
don’t accidentally perform any quantitative operations on them later.
Thus, <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>’s useful <code>mutate</code> method can be
applied to <code>phenograph</code> to convert those two columns into
character vectors.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenograph</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">phenograph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># mutate the input tof_tbl</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    PhenoGraph <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">PhenoGraph</span><span class="op">)</span>, </span>
<span>    Condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Condition</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">phenograph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># use dplyr's select method to show </span></span>
<span>  <span class="co"># that the columns have been changed</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="../reference/where.html">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 300 × 3</span></span></span>
<span><span class="co">#&gt;   file_name                  PhenoGraph Condition</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> H1_PhenoGraph_cluster1.fcs 7          7        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> H1_PhenoGraph_cluster1.fcs 6          6        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> H1_PhenoGraph_cluster1.fcs 9          9        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> H1_PhenoGraph_cluster1.fcs 2          2        </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 296 more rows</span></span></span></code></pre></div>
<p>And note that the <code>tof_tbl</code> class is preserved even after
these transformations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenograph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tof_tbl"    "tbl_df"     "tbl"        "data.frame"</span></span></code></pre></div>
<p>Importantly, <code>tof_read_data</code> uses an opinionated heuristic
to mine different keyword slots of input FCS file(s) and guess which
metals and antigens were used during data acquisition. Thus, when CSV
files are read using <code>tof_read_data</code>, it is recommended to
use the <code>panel_info</code> argument to provide the panel manually
(as CSV files, unlike FCS files, do not provide built-in metadata about
the columns they contain).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># when csv files are read, the tof_tibble's "panel"</span></span>
<span><span class="co"># attribute will be empty by default</span></span>
<span><span class="fu"><a href="../reference/tidytof_example_data.html">tidytof_example_data</a></span><span class="op">(</span><span class="st">"phenograph_csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_read_data.html">tof_read_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_get_panel.html">tof_get_panel</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 0</span></span></span>
<span></span>
<span><span class="co"># to add a panel manually, provide it as a tibble </span></span>
<span><span class="co"># to tof_read_data</span></span>
<span><span class="va">phenograph_panel</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">phenograph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_get_panel.html">tof_get_panel</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tidytof_example_data.html">tidytof_example_data</a></span><span class="op">(</span><span class="st">"phenograph_csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_read_data.html">tof_read_data</a></span><span class="op">(</span>panel_info <span class="op">=</span> <span class="va">phenograph_panel</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_get_panel.html">tof_get_panel</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 44 × 2</span></span></span>
<span><span class="co">#&gt;   antigens    metals     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Time        Time       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Cell_length Cell_length</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> DNA1        Ir191      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> DNA2        Ir193      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="writing-data-from-a-tof_tbl-to-disk">Writing data from a <code>tof_tbl</code> to disk<a class="anchor" aria-label="anchor" href="#writing-data-from-a-tof_tbl-to-disk"></a>
</h2>
<p>Users may wish to store CyTOF data as FCS or CSV files after
transformation, concatenation, filtering, or other data processing. To
write single-cell data from a <code>tof_tbl</code> into FCS or CSV
files, use <code>tof_write_data</code>. To illustrate how to use this
verb, we use the <a href="https://keyes-timothy.github.io/tidytof">tidytof</a>’s built-in
<code>phenograph_data</code> dataset.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">phenograph_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">phenograph_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,000 × 25</span></span></span>
<span><span class="co">#&gt;   sample_name  phenograph_cluster    cd19 cd11b   cd34  cd45  cd123   cd33  cd47</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> H1_PhenoGra… cluster1           -<span style="color: #BB0000;">0.168</span>  29.0   3.23   131. -<span style="color: #BB0000;">0.609</span>  1.21   13.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> H1_PhenoGra… cluster1            1.65    4.83 -<span style="color: #BB0000;">0.582</span>  230.  2.53  -<span style="color: #BB0000;">0.507</span>  12.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> H1_PhenoGra… cluster1            2.79   36.1   5.20   293. -<span style="color: #BB0000;">0.265</span>  3.67   27.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> H1_PhenoGra… cluster1            0.081<span style="text-decoration: underline;">6</span> 48.8   0.363  431.  2.04   9.40   41.0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,996 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 16 more variables: cd7 &lt;dbl&gt;, cd44 &lt;dbl&gt;, cd38 &lt;dbl&gt;, cd3 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   cd117 &lt;dbl&gt;, cd64 &lt;dbl&gt;, cd41 &lt;dbl&gt;, pstat3 &lt;dbl&gt;, pstat5 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   pampk &lt;dbl&gt;, p4ebp1 &lt;dbl&gt;, ps6 &lt;dbl&gt;, pcreb &lt;dbl&gt;, `pzap70-syk` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   prb &lt;dbl&gt;, `perk1-2` &lt;dbl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># when copying and pasting this code, feel free to change this path </span></span>
<span><span class="co"># to wherever you'd like to save your output files</span></span>
<span><span class="va">my_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"~"</span>, <span class="st">"Desktop"</span>, <span class="st">"tidytof_vignette_files"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phenograph_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_write_data.html">tof_write_data</a></span><span class="op">(</span></span>
<span>    group_cols <span class="op">=</span> <span class="va">phenograph_cluster</span>, </span>
<span>    out_path <span class="op">=</span> <span class="va">my_path</span>,</span>
<span>    format <span class="op">=</span> <span class="st">"fcs"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><code>tof_write_data</code>’s trickiest argument is
<code>group_cols</code>, the argument used to specify which columns in
<code>tof_tibble</code> should be used to group cells (the rows of
<code>tof_tibble</code>) into separate FCS or CSV files. Simply put,
this argument allows <code>tof_write_data</code> to create a single FCS
or CSV file for each unique combination of values in the
<code>group_cols</code> columns specified by the user. In the example
above, cells are grouped into 3 output FCS files - one for each of the 3
clusters encoded by the <code>phenograph_cluster</code> column in
<code>phenograph_data</code>. These files should have the following
names (derived from the values in the <code>phenograph_cluster</code>
column):</p>
<ul>
<li>cluster1.fcs</li>
<li>cluster2.fcs</li>
<li>cluster3.fcs</li>
</ul>
<p>Note that these file names match the distinct values in our
<code>group_cols</code> column (<code>phenograph_cluster</code>):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenograph_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">phenograph_cluster</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 1</span></span></span>
<span><span class="co">#&gt;   phenograph_cluster</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cluster1          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cluster2          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> cluster3</span></span></code></pre></div>
<p>However, suppose we wanted to write multiple files for each cluster
by breaking cells into two groups: those that express high levels of
<code>pstat5</code> and those that express low levels of
<code>pstat5</code>. We can use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code> to create a
new column in <code>phenograph_data</code> that breaks cells into high-
and low-<code>pstat5</code> expression groups, then add this column to
our <code>group_cols</code> specification:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenograph_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># create a variable representing if a cell is above or below </span></span>
<span>  <span class="co"># the median expression level of pstat5</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    expression_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">pstat5</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">pstat5</span><span class="op">)</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tof_write_data.html">tof_write_data</a></span><span class="op">(</span></span>
<span>    group_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">phenograph_cluster</span>, <span class="va">expression_group</span><span class="op">)</span>, </span>
<span>    out_path <span class="op">=</span> <span class="va">my_path</span>, </span>
<span>    format <span class="op">=</span> <span class="st">"fcs"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This will write 6 files with the following names (derived from the
values in <code>phenograph_cluster</code> and
<code>expression_group</code>).</p>
<ul>
<li>cluster1_low.fcs</li>
<li>cluster1_high.fcs</li>
<li>cluster2_low.fcs</li>
<li>cluster2_high.fcs</li>
<li>cluster3_low.fcs</li>
<li>cluster3_high.fcs</li>
</ul>
<p>As above, note that these file names match the distinct values in our
<code>group_cols</code> columns (<code>phenograph_cluster</code> and
<code>expression_group</code>):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phenograph_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    expression_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">pstat5</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">pstat5</span><span class="op">)</span>, <span class="st">"high"</span>, <span class="st">"low"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">phenograph_cluster</span>, <span class="va">expression_group</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   phenograph_cluster expression_group</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> cluster1           low             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cluster1           high            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> cluster2           low             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> cluster2           high            </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more rows</span></span></span></code></pre></div>
<p>A useful feature of <code>tof_write_data</code> is that it will
automatically concatenate cells into single FCS or CSV files based on
the specified <code>group_cols</code> <em>regardless of how many unique
files those cells came from</em>. This allows for easy concatenation of
FCS or CSV files containing data from a single sample acquired over
multiple CyTOF runs, for example.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Timothy Keyes.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
