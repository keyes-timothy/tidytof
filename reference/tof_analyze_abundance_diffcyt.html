<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Differential Abundance Analysis (DAA) with diffcyt — tof_analyze_abundance_diffcyt • tidytof</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Differential Abundance Analysis (DAA) with diffcyt — tof_analyze_abundance_diffcyt"><meta name="description" content="This function performs differential abundance analysis on the cell clusters
contained within a `tof_tbl` using one of three
methods implemented in the diffcyt
package for differential discovery analysis in high-dimensional cytometry
data."><meta property="og:description" content="This function performs differential abundance analysis on the cell clusters
contained within a `tof_tbl` using one of three
methods implemented in the diffcyt
package for differential discovery analysis in high-dimensional cytometry
data."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidytof</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tidytof.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending {tidytof}</h6></li>
    <li><a class="dropdown-item" href="../articles/contributing-to-tidytof.html">How to contribute code</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cell-level operations</h6></li>
    <li><a class="dropdown-item" href="../articles/reading-and-writing-data.html">Reading and writing data</a></li>
    <li><a class="dropdown-item" href="../articles/quality-control.html">Quality control</a></li>
    <li><a class="dropdown-item" href="../articles/preprocessing.html">Preprocessing</a></li>
    <li><a class="dropdown-item" href="../articles/downsampling.html">Downsampling</a></li>
    <li><a class="dropdown-item" href="../articles/dimensionality-reduction.html">Dimensionality reduction</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cluster-level operations</h6></li>
    <li><a class="dropdown-item" href="../articles/clustering.html">Clustering and metaclustering</a></li>
    <li><a class="dropdown-item" href="../articles/differential-discovery-analysis.html">Differential discovery analysis</a></li>
    <li><a class="dropdown-item" href="../articles/feature-extraction.html">Feature extraction</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Sample-level operations</h6></li>
    <li><a class="dropdown-item" href="../articles/modeling.html">Building predictive models</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/keyes-timothy/tidytof/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Differential Abundance Analysis (DAA) with diffcyt</h1>
      <small class="dont-index">Source: <a href="https://github.com/keyes-timothy/tidytof/blob/main/R/differential_discovery.R" class="external-link"><code>R/differential_discovery.R</code></a></small>
      <div class="d-none name"><code>tof_analyze_abundance_diffcyt.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs differential abundance analysis on the cell clusters
contained within a `tof_tbl` using one of three
methods implemented in the <a href="https://www.bioconductor.org/packages/release/bioc/html/diffcyt.html" class="external-link">diffcyt</a>
package for differential discovery analysis in high-dimensional cytometry
data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tof_analyze_abundance_diffcyt</span><span class="op">(</span></span>
<span>  <span class="va">tof_tibble</span>,</span>
<span>  <span class="va">sample_col</span>,</span>
<span>  <span class="va">cluster_col</span>,</span>
<span>  <span class="va">fixed_effect_cols</span>,</span>
<span>  <span class="va">random_effect_cols</span>,</span>
<span>  diffcyt_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glmm"</span>, <span class="st">"edgeR"</span>, <span class="st">"voom"</span><span class="op">)</span>,</span>
<span>  include_observation_level_random_effects <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  min_cells <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  min_samples <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tof-tibble">tof_tibble<a class="anchor" aria-label="anchor" href="#arg-tof-tibble"></a></dt>
<dd><p>A `tof_tbl` or a `tibble`.</p></dd>


<dt id="arg-sample-col">sample_col<a class="anchor" aria-label="anchor" href="#arg-sample-col"></a></dt>
<dd><p>An unquoted column name indicating which column in `tof_tibble`
represents the id of the sample from which each cell was collected. `sample_col`
should serve as a unique identifier for each sample collected during data acquisition -
all cells with the same value for `sample_col` will be treated as a part of the same
observational unit.</p></dd>


<dt id="arg-cluster-col">cluster_col<a class="anchor" aria-label="anchor" href="#arg-cluster-col"></a></dt>
<dd><p>An unquoted column name indicating which column in `tof_tibble`
stores the cluster ids of the cluster to which each cell belongs.
Cluster labels can be produced via any method the user chooses - including manual gating,
any of the functions in the `tof_cluster_*` function family, or any other method.</p></dd>


<dt id="arg-fixed-effect-cols">fixed_effect_cols<a class="anchor" aria-label="anchor" href="#arg-fixed-effect-cols"></a></dt>
<dd><p>Unquoted column names representing which columns in
`tof_tibble` should be used to model fixed effects during the differential
abundance analysis. Generally speaking, fixed effects represent the
comparisons of biological interest (often the variables manipulated during
experiments), such as treated vs. non-treated, before-treatment vs. after-treatment,
or healthy vs. non-healthy.</p></dd>


<dt id="arg-random-effect-cols">random_effect_cols<a class="anchor" aria-label="anchor" href="#arg-random-effect-cols"></a></dt>
<dd><p>Optional. Unquoted column names representing which columns in
`tof_tibble` should be used to model random effects during the differential
abundance analysis. Generally speaking, random effects should represent variables
that a researcher wants to control/account for, but that are not necessarily
of biological interest. Example random effect variables might include batch id,
patient id (in a paired design), or patient age.</p>
<p>Note that without multiple samples at each level of each of the
random effect variables, it can be easy to overfit mixed models. For most high-dimensional cytometry
experiments, 2 or fewer (and often 0) random effect variables are appropriate.</p></dd>


<dt id="arg-diffcyt-method">diffcyt_method<a class="anchor" aria-label="anchor" href="#arg-diffcyt-method"></a></dt>
<dd><p>A string indicating which diffcyt method should be used for the
differential abundance analysis. Valid methods include "glmm" (the default),
"edgeR", and "voom".</p></dd>


<dt id="arg-include-observation-level-random-effects">include_observation_level_random_effects<a class="anchor" aria-label="anchor" href="#arg-include-observation-level-random-effects"></a></dt>
<dd><p>A boolean value indicating
if "observation-level random effects" (OLREs) should be included as random effect
terms in a "glmm" differential abundance model. For details about what OLREs are, see
<a href="https://www.nature.com/articles/s42003-019-0415-5" class="external-link">the diffcyt paper</a>. Only the
"glmm" method can model observation-level random effects, and all other values will ignore
this argument (and throw a warning if it is set to TRUE).
Defaults to FALSE.</p></dd>


<dt id="arg-min-cells">min_cells<a class="anchor" aria-label="anchor" href="#arg-min-cells"></a></dt>
<dd><p>An integer value used to filter clusters out of the differential
abundance analysis. Clusters are not included in the differential abundance testing
if they do not have at least `min_cells` in at least `min_samples` samples.
Defaults to 3.</p></dd>


<dt id="arg-min-samples">min_samples<a class="anchor" aria-label="anchor" href="#arg-min-samples"></a></dt>
<dd><p>An integer value used to filter clusters out of the differential
abundance analysis. Clusters are not included in the differential abundance testing
if they do not have at least `min_cells` in at least `min_samples` samples.
Defaults to 5.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>A numeric value between 0 and 1 indicating which significance
level should be applied to multiple-comparison adjusted p-values during the
differential abundance analysis. Defaults to 0.05.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional additional arguments to pass to the under-the-hood diffcyt
function being used to perform the differential abundance analysis. See
<code><a href="https://rdrr.io/pkg/diffcyt/man/testDA_GLMM.html" class="external-link">testDA_GLMM</a></code>, <code><a href="https://rdrr.io/pkg/diffcyt/man/testDA_edgeR.html" class="external-link">testDA_edgeR</a></code>, and
<code><a href="https://rdrr.io/pkg/diffcyt/man/testDA_voom.html" class="external-link">testDA_voom</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A nested tibble with two columns: `tested_effect` and `daa_results`.</p>
<p>The first column, `tested_effect`
is a character vector indicating which term in the differential abundance model
was used for significance testing. The values in this row are obtained
by pasting together the column names for each fixed effect variable and each
of its values. For example, a fixed effect column named `fixed_effect` with
levels "a", "b", and "c" have two terms in `tested_effect`: "fixed_effectb" and
"fixed_effectc" (note that level "a" of fixed_effect is set as the reference
level during dummy coding). These values correspond to the terms in the
differential abundance model that represent the difference in cluster abundances
between samples with fixed_effect = "b" and fixed_effect = "a" and between
samples with fixed_effect = "c" and fixed_effect = "a", respectively. In addition,
the first row in `tested_effect` will always represent the "omnibus"
test, or the test that there were significant differences between <em>any</em> levels of
<em>any</em> fixed effect variable in the model.</p>
<p>The second column, `daa_results` is a list of tibbles in which each entry gives
the differential abundance results for each tested_effect. Within each entry
of `daa_results`, you will find several columns including the following:
* `p_val`, the p-value associated with each
tested effect in each input cluster
* `p_adj`, the multiple-comparison
adjusted p-value (using the <code><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></code> function)
* Other values associated with the underlying method used to perform the
differential abundance analysis (such as the log-fold change of cluster
abundance between the levels being compared). For details, see
<code><a href="https://rdrr.io/pkg/edgeR/man/glmfit.html" class="external-link">glmFit</a></code>, <code><a href="https://rdrr.io/pkg/limma/man/voom.html" class="external-link">voom</a></code>, <code><a href="https://rdrr.io/pkg/limma/man/toptable.html" class="external-link">topTable</a></code>,
and <code><a href="https://rdrr.io/pkg/diffcyt/man/testDA_GLMM.html" class="external-link">testDA_GLMM</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The three methods are based on generalized linear mixed models ("glmm"),
<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2796818/" class="external-link">edgeR</a> ("edgeR"), and
<a href="https://genomebiology.biomedcentral.com/articles/10.1186/gb-2014-15-2-r29" class="external-link">voom</a> ("voom").
While both the "glmm" and "voom" methods can model both fixed effects and random
effects, the "edgeR" method can only model fixed effects.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other differential abundance analysis functions:
<code><a href="tof_analyze_abundance.html">tof_analyze_abundance</a>()</code>,
<code><a href="tof_analyze_abundance_glmm.html">tof_analyze_abundance_glmm</a>()</code>,
<code><a href="tof_analyze_abundance_ttest.html">tof_analyze_abundance_ttest</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># For differential discovery examples, please see the package vignettes</span></span></span>
<span class="r-in"><span><span class="cn">NULL</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Timothy Keyes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

